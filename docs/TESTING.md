# テスティングガイド

## 実機テスト手順

### 前提条件
- iOS 17.0以上の実機
- Xcodeでプロジェクトが正常にビルドできること
- 開発者証明書が設定されていること

### テスト項目

#### 1. テキストのコピー＆ペースト

**手順:**
1. アプリを起動
2. クリップボードアクセスの許可を承認
3. PiPモードが自動で開始されることを確認
4. Safari等で適当なテキストをコピー
5. アプリに戻り、履歴にテキストが追加されていることを確認
6. テキストをタップしてペーストできることを確認

**期待される動作:**
- テキストが即座に履歴に表示される
- タイムスタンプが正しく表示される
- テキストのプレビューが2行まで表示される
- ファイルサイズが表示される

#### 2. 画像のコピー

**手順:**
1. 写真アプリから任意の写真をコピー
2. またはスクリーンショットを撮影
3. アプリに戻り、履歴に画像が追加されていることを確認
4. サムネイルが表示されていることを確認
5. 画像をタップしてプレビューが開くことを確認
6. プレビュー画面でピンチ操作ができることを確認
7. ShareLinkで共有できることを確認

**期待される動作:**
- 画像のサムネイル（200x200）が表示される
- 画像ファイルサイズが表示される
- プレビュー画面が全画面で開く
- スクロール・ピンチ操作が可能

#### 3. URLのコピー

**手順:**
1. SafariでURLをコピー
2. アプリに戻り、履歴にURLが追加されていることを確認
3. ホスト名が表示されていることを確認
4. URLの全文がキャプションに表示されていることを確認

**期待される動作:**
- URLアイコン（リンクマーク）が表示される
- ホスト名が大きく表示される
- 完全なURLが小さく表示される

#### 4. 履歴の削除

**手順:**
1. 履歴アイテムを左スワイプ
2. 削除ボタンをタップ
3. アイテムが削除されることを確認
4. 関連する画像ファイルも削除されることを確認（開発者向け）

**期待される動作:**
- スワイプで削除ボタンが表示される
- 削除後、即座にリストから消える
- 保存ファイルも削除される

#### 5. 一括削除

**手順:**
1. 「すべて削除」ボタンをタップ
2. すべてのアイテムが削除されることを確認
3. ストレージが解放されることを確認（開発者向け）

**期待される動作:**
- すべてのアイテムが削除される
- ストレージディレクトリが空になる

#### 6. バックグラウンドでの監視（PiP）

**手順:**
1. アプリを起動し、PiPモードに入る
2. ホーム画面に戻る
3. PiPウィンドウが表示されていることを確認
4. 他のアプリでテキスト・画像をコピー
5. アプリに戻り、履歴に追加されていることを確認

**期待される動作:**
- バックグラウンドでもコピーを検出
- PiPウィンドウが表示され続ける
- 履歴が正しく保存される

#### 7. アプリ再起動後の復元

**手順:**
1. アプリを完全終了（スワイプで閉じる）
2. アプリを再起動
3. 以前の履歴が復元されていることを確認
4. サムネイルが正しく表示されることを確認

**期待される動作:**
- すべての履歴が復元される
- 画像のサムネイルも復元される
- タイムスタンプが正しく表示される

#### 8. ストレージ管理

**開発者向け:**
1. コンソールでログを確認
2. Documentsディレクトリを確認
   - `ClipboardHistory/items.json`にメタデータ
   - 画像ファイルが`{UUID}_image.dat`として保存
   - サムネイルが`{UUID}_thumbnail.dat`として保存
3. ストレージサイズが正しく計算されていることを確認

**確認ポイント:**
```
~/Library/Developer/CoreSimulator/Devices/{DEVICE_ID}/data/Containers/Data/Application/{APP_ID}/Documents/ClipboardHistory/
├── items.json
├── {UUID}_image.dat
├── {UUID}_thumbnail.dat
└── ...
```

### パフォーマンステスト

#### 大量の履歴

**手順:**
1. 100件のアイテムを追加
2. スクロールがスムーズであることを確認
3. メモリ使用量を確認

#### 大きな画像

**手順:**
1. 10MB以上の大きな画像をコピー
2. サムネイル生成に時間がかかりすぎないことを確認
3. アプリがクラッシュしないことを確認

### 既知の問題

- **iOS 16以降の制限**: 初回アクセス時にシステムの許可ダイアログが表示される
- **PiPの制約**: シミュレーターでは動作しない
- **メモリ**: 大量の画像を保存すると、ストレージが圧迫される可能性がある

## トラブルシューティング

### クリップボードが検出されない

- クリップボードアクセスが許可されているか確認
- PiPモードが有効になっているか確認
- ログを確認してエラーがないかチェック

### 画像が表示されない

- 画像ファイルが正しく保存されているか確認
- Documentsディレクトリのパーミッションを確認
- ログでエラーを確認

### アプリがクラッシュする

- メモリ使用量を確認
- 大きな画像の処理でメモリ不足になっていないかチェック
- クラッシュログを確認

## ログの確認方法

Xcodeのコンソールで以下のカテゴリのログを確認:
- `com.copyPaste.Clipboard` - クリップボード監視
- `com.copyPaste.PiP` - PiP管理
- `com.copyPaste.Storage` - ストレージ操作

フィルター例:
```
subsystem:com.copyPaste
```
